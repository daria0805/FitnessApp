{% extends 'base.html.twig' %}

{% block title %}Hello YogaController!{% endblock %}


{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div class="example-wrapper">
    <h1>Hello {{ app.user.email }}! âœ…</h1>
    <h1>Yoga Exercises</h1>

    <button id="pauseButton" onclick="pauseWorkout()" class="btn btn-primary">Pause Workout</button>
    <button id="resumeButton" onclick="resumeWorkout()" class="btn btn-primary" style="display: none;" data-durations="{{ durations|json_encode() }}">{{ 'Resume Workout' }}</button>

    <a href="{{ path('exit_workout') }}" class="btn btn-danger">Exit Workout</a>


    {% for key, exercise in exercises %}
        <div id="exercise{{ key }}" class="exercise" {% if key != 0 %}style="display: none;"{% endif %}>
            <h2>{{ exercise.getName() }}</h2>
            <p>{{ exercise.getDescription() }}</p>
            <img src="{{ asset(exercisePhotos[key]) }}" alt="Exercise Photo">
            <div id="timer{{ key }}" class="timer"></div>
        </div>
    {% endfor %}

    <div id="message" style="display: none;">All exercises completed!</div>

    <script>
        var totalExercises = {{ exercises|length }};
        var currentExercise = 0;
        var pauseButton = document.getElementById("pauseButton");
        var resumeButton = document.getElementById("resumeButton");
        var workoutStarted = false;
        var workoutPaused = false;
        var durations = JSON.parse(document.getElementById("resumeButton").getAttribute("data-durations"));
        var timerInterval;
        var remainingTime = 0;

        startTimer(currentExercise, durations[currentExercise]);

        function startTimer(key, duration) {
            var timer = document.getElementById("timer" + key);
            var seconds = duration - remainingTime; // Use remaining time
            timerInterval = setInterval(function() {
                timer.innerHTML = seconds;
                seconds--;

                if (seconds < 0) {
                    clearInterval(timerInterval);
                    timer.innerHTML = "Timer ended";
                    document.getElementById("exercise" + key).style.display = "none";
                    currentExercise++;

                    if (currentExercise < totalExercises) {
                        document.getElementById("exercise" + currentExercise).style.display = "block";

                        if (!workoutPaused) {
                            remainingTime = 0; // Reset remaining time
                            startTimer(currentExercise, durations[currentExercise]);
                        }
                    } else {
                        document.getElementById("message").style.display = "block";
                        pauseButton.style.display = "none";
                        resumeButton.style.display = "none";
                    }
                }
            }, 1000);
        }

        function pauseWorkout() {
            console.log("Pause button clicked");
            clearInterval(timerInterval);
            workoutPaused = true;
            pauseButton.style.display = "none";
            resumeButton.style.display = "inline-block";
            remainingTime = durations[currentExercise] - document.getElementById("timer" + currentExercise).innerHTML; // Store remaining time
        }

        function resumeWorkout() {
            console.log("Resume button clicked");
            startTimer(currentExercise, durations[currentExercise]);
            workoutPaused = false;
            pauseButton.style.display = "inline-block";
            resumeButton.style.display = "none";
        }

        function exitWorkout() {
            window.location.href = "{{ path('exit_workout') }}";
        }
    </script>
</div>
{% endblock %}
