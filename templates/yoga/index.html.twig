{% extends 'base.html.twig' %}

{% block title %}Hello YogaController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div class="example-wrapper">
    <h1>Hello {{ app.user.email }}! âœ…</h1>
     <h1>Yoga Exercises</h1>


<button id="startButton" onclick="startWorkout()">Start Workout</button>
<button id="pauseButton" onclick="pauseWorkout()" style="display: none;">Pause Workout</button>
<button id="resumeButton" onclick="resumeWorkout()" style="display: none;">Resume Workout</button>

{% for key, exercise in exercises %}
<div id="exercise{{ key }}" class="exercise" {% if key != 0 %}style="display: none;"{% endif %}>
    <h2>{{ exercise.getName() }}</h2>
    <p>{{ exercise.getDescription() }}</p>
    <img src="{{ asset(exercisePhotos[key]) }}" alt="Exercise Photo">
    <div id="timer{{ key }}" class="timer"></div>
    {# <script>console.log("Exercise {{ key }} rendered.");</script> #}
</div>
{% endfor %}
{# {{ dump(exercisePhotos) }} #}
<div id="message" style="display: none;">All exercises completed!</div>


<script>
//-----------------TIMER---------
    // Start the timers
    {% for key, duration in durations %}
        setTimeout(function() {
            startTimer({{ key }}, {{ durations[key] }});
        }, {{ key > 0 ? durations[key - 1] * 1000 : 0 }});
    {% endfor %}


    var totalExercises = {{ exercises|length }};
    
    // Initialize the current exercise index
    var currentExercise = 0;

    var startButton = document.getElementById("startButton");
    var pauseButton = document.getElementById("pauseButton");
    var resumeButton = document.getElementById("resumeButton");

    var interval;
    var workoutStarted = false;
    var workoutPaused = false;
    
    // Start the timer for the first exercise
    startTimer(currentExercise, durations[currentExercise]);

    // Start the workout when the start button is clicked
    function startWorkout() {
        if (!workoutStarted) {
            // Hide the start button and show the pause button
            startButton.style.display = "none";
            pauseButton.style.display = "inline-block";
            
            // Start the timer for the first exercise
            startTimer(currentExercise, durations[currentExercise]);
            
            workoutStarted = true;
        }
    }
    
    // Pause the workout when the pause button is clicked
    function pauseWorkout() {
        if (interval && !workoutPaused) {
            clearInterval(interval);
            interval = null;
            workoutPaused = true;
            pauseButton.style.display = "none";
            resumeButton.style.display = "inline-block";
        }
    }
        // Resume the workout when the resume button is clicked
    function resumeWorkout() {
        if (!interval && workoutPaused) {
            workoutPaused = false;
            resumeButton.style.display = "none";
            pauseButton.style.display = "inline-block";
            startTimer(currentExercise, durations[currentExercise]);
        }
    }

    // Timer function
    function startTimer(key, duration) {
        var timer = document.getElementById("timer" + key);
        //var exercise = document.getElementById("exercise" + key);
        var seconds = duration;
        var interval = setInterval(function() {
            timer.innerHTML = seconds;
            seconds--;
            if (seconds < 0) {
                clearInterval(interval);
                timer.innerHTML = "Timer ended";
                
                // Hide the current exercise
                document.getElementById("exercise" + key).style.display = "none";
                // Increment the current exercise index
                currentExercise++;
                
                // Display the next exercise if available
                if (currentExercise < totalExercises) {
                    document.getElementById("exercise" + currentExercise).style.display = "block";
                    startTimer(currentExercise, durations[currentExercise]);
                    if (!workoutPaused) {
                        startTimer(currentExercise, durations[currentExercise]);
                    }
                } else {
                    // Show the completion message
                    document.getElementById("message").style.display = "block";
                    // Hide the pause button
                    pauseButton.style.display = "none";       
                    resumeButton.style.display = "none";
         
                }
            }
        }, 1000);
    }

</script>


</div>
{% endblock %}
